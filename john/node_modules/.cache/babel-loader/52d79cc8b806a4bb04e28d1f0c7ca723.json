{"ast":null,"code":"/**\n * jQuery Ripples plugin v0.6.3 / https://github.com/sirxemic/jquery.ripples\n * MIT License\n * @author sirxemic / https://sirxemic.com/\n */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(require('jquery')) : typeof define === 'function' && define.amd ? define(['jquery'], factory) : factory(global.$);\n})(this, function ($) {\n  'use strict';\n\n  $ = $ && 'default' in $ ? $['default'] : $;\n  var gl;\n  var $window = $(window); // There is only one window, so why not cache the jQuery-wrapped window?\n\n  function isPercentage(str) {\n    return str[str.length - 1] == '%';\n  }\n  /**\r\n   *  Load a configuration of GL settings which the browser supports.\r\n   *  For example:\r\n   *  - not all browsers support WebGL\r\n   *  - not all browsers support floating point textures\r\n   *  - not all browsers support linear filtering for floating point textures\r\n   *  - not all browsers support rendering to floating point textures\r\n   *  - some browsers *do* support rendering to half-floating point textures instead.\r\n   */\n\n\n  function loadConfig() {\n    var canvas = document.createElement('canvas');\n    gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n\n    if (!gl) {\n      // Browser does not support WebGL.\n      return null;\n    } // Load extensions\n\n\n    var extensions = {};\n    ['OES_texture_float', 'OES_texture_half_float', 'OES_texture_float_linear', 'OES_texture_half_float_linear'].forEach(function (name) {\n      var extension = gl.getExtension(name);\n\n      if (extension) {\n        extensions[name] = extension;\n      }\n    }); // If no floating point extensions are supported we can bail out early.\n\n    if (!extensions.OES_texture_float) {\n      return null;\n    }\n\n    var configs = [];\n\n    function createConfig(type, glType, arrayType) {\n      var name = 'OES_texture_' + type,\n          nameLinear = name + '_linear',\n          linearSupport = (nameLinear in extensions),\n          configExtensions = [name];\n\n      if (linearSupport) {\n        configExtensions.push(nameLinear);\n      }\n\n      return {\n        type: glType,\n        arrayType: arrayType,\n        linearSupport: linearSupport,\n        extensions: configExtensions\n      };\n    }\n\n    configs.push(createConfig('float', gl.FLOAT, Float32Array));\n\n    if (extensions.OES_texture_half_float) {\n      configs.push( // Array type should be Uint16Array, but at least on iOS that breaks. In that case we\n      // just initialize the textures with data=null, instead of data=new Uint16Array(...).\n      // This makes initialization a tad slower, but it's still negligible.\n      createConfig('half_float', extensions.OES_texture_half_float.HALF_FLOAT_OES, null));\n    } // Setup the texture and framebuffer\n\n\n    var texture = gl.createTexture();\n    var framebuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE); // Check for each supported texture type if rendering to it is supported\n\n    var config = null;\n\n    for (var i = 0; i < configs.length; i++) {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 32, 32, 0, gl.RGBA, configs[i].type, null);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n      if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE) {\n        config = configs[i];\n        break;\n      }\n    }\n\n    return config;\n  }\n\n  function createImageData(width, height) {\n    try {\n      return new ImageData(width, height);\n    } catch (e) {\n      // Fallback for IE\n      var canvas = document.createElement('canvas');\n      return canvas.getContext('2d').createImageData(width, height);\n    }\n  }\n\n  function translateBackgroundPosition(value) {\n    var parts = value.split(' ');\n\n    if (parts.length === 1) {\n      switch (value) {\n        case 'center':\n          return ['50%', '50%'];\n\n        case 'top':\n          return ['50%', '0'];\n\n        case 'bottom':\n          return ['50%', '100%'];\n\n        case 'left':\n          return ['0', '50%'];\n\n        case 'right':\n          return ['100%', '50%'];\n\n        default:\n          return [value, '50%'];\n      }\n    } else {\n      return parts.map(function (part) {\n        switch (value) {\n          case 'center':\n            return '50%';\n\n          case 'top':\n          case 'left':\n            return '0';\n\n          case 'right':\n          case 'bottom':\n            return '100%';\n\n          default:\n            return part;\n        }\n      });\n    }\n  }\n\n  function createProgram(vertexSource, fragmentSource, uniformValues) {\n    function compileSource(type, source) {\n      var shader = gl.createShader(type);\n      gl.shaderSource(shader, source);\n      gl.compileShader(shader);\n\n      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        throw new Error('compile error: ' + gl.getShaderInfoLog(shader));\n      }\n\n      return shader;\n    }\n\n    var program = {};\n    program.id = gl.createProgram();\n    gl.attachShader(program.id, compileSource(gl.VERTEX_SHADER, vertexSource));\n    gl.attachShader(program.id, compileSource(gl.FRAGMENT_SHADER, fragmentSource));\n    gl.linkProgram(program.id);\n\n    if (!gl.getProgramParameter(program.id, gl.LINK_STATUS)) {\n      throw new Error('link error: ' + gl.getProgramInfoLog(program.id));\n    } // Fetch the uniform and attribute locations\n\n\n    program.uniforms = {};\n    program.locations = {};\n    gl.useProgram(program.id);\n    gl.enableVertexAttribArray(0);\n    var match,\n        name,\n        regex = /uniform (\\w+) (\\w+)/g,\n        shaderCode = vertexSource + fragmentSource;\n\n    while ((match = regex.exec(shaderCode)) != null) {\n      name = match[2];\n      program.locations[name] = gl.getUniformLocation(program.id, name);\n    }\n\n    return program;\n  }\n\n  function bindTexture(texture, unit) {\n    gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n  }\n\n  function extractUrl(value) {\n    var urlMatch = /url\\([\"']?([^\"']*)[\"']?\\)/.exec(value);\n\n    if (urlMatch == null) {\n      return null;\n    }\n\n    return urlMatch[1];\n  }\n\n  function isDataUri(url) {\n    return url.match(/^data:/);\n  }\n\n  var config = loadConfig();\n  var transparentPixels = createImageData(32, 32); // Extend the css\n\n  $('head').prepend('<style>.jquery-ripples { position: relative; z-index: 0; }</style>'); // RIPPLES CLASS DEFINITION\n  // =========================\n\n  var Ripples = function (el, options) {\n    var that = this;\n    this.$el = $(el); // Init properties from options\n\n    this.interactive = options.interactive;\n    this.resolution = options.resolution;\n    this.textureDelta = new Float32Array([1 / this.resolution, 1 / this.resolution]);\n    this.perturbance = options.perturbance;\n    this.dropRadius = options.dropRadius;\n    this.crossOrigin = options.crossOrigin;\n    this.imageUrl = options.imageUrl; // Init WebGL canvas\n\n    var canvas = document.createElement('canvas');\n    canvas.width = this.$el.innerWidth();\n    canvas.height = this.$el.innerHeight();\n    this.canvas = canvas;\n    this.$canvas = $(canvas);\n    this.$canvas.css({\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n      zIndex: -1\n    });\n    this.$el.addClass('jquery-ripples').append(canvas);\n    this.context = gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl'); // Load extensions\n\n    config.extensions.forEach(function (name) {\n      gl.getExtension(name);\n    }); // Auto-resize when window size changes.\n\n    this.updateSize = this.updateSize.bind(this);\n    $(window).on('resize', this.updateSize); // Init rendertargets for ripple data.\n\n    this.textures = [];\n    this.framebuffers = [];\n    this.bufferWriteIndex = 0;\n    this.bufferReadIndex = 1;\n    var arrayType = config.arrayType;\n    var textureData = arrayType ? new arrayType(this.resolution * this.resolution * 4) : null;\n\n    for (var i = 0; i < 2; i++) {\n      var texture = gl.createTexture();\n      var framebuffer = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, config.linearSupport ? gl.LINEAR : gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, config.linearSupport ? gl.LINEAR : gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.resolution, this.resolution, 0, gl.RGBA, config.type, textureData);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n      this.textures.push(texture);\n      this.framebuffers.push(framebuffer);\n    } // Init GL stuff\n\n\n    this.quad = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.quad);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, +1, -1, +1, +1, -1, +1]), gl.STATIC_DRAW);\n    this.initShaders();\n    this.initTexture();\n    this.setTransparentTexture(); // Load the image either from the options or CSS rules\n\n    this.loadImage(); // Set correct clear color and blend mode (regular alpha blending)\n\n    gl.clearColor(0, 0, 0, 0);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA); // Plugin is successfully initialized!\n\n    this.visible = true;\n    this.running = true;\n    this.inited = true;\n    this.destroyed = false;\n    this.setupPointerEvents(); // Init animation\n\n    function step() {\n      if (!that.destroyed) {\n        that.step();\n        requestAnimationFrame(step);\n      }\n    }\n\n    requestAnimationFrame(step);\n  };\n\n  Ripples.DEFAULTS = {\n    imageUrl: null,\n    resolution: 256,\n    dropRadius: 20,\n    perturbance: 0.03,\n    interactive: true,\n    crossOrigin: ''\n  };\n  Ripples.prototype = {\n    // Set up pointer (mouse + touch) events\n    setupPointerEvents: function () {\n      var that = this;\n\n      function pointerEventsEnabled() {\n        return that.visible && that.running && that.interactive;\n      }\n\n      function dropAtPointer(pointer, big) {\n        if (pointerEventsEnabled()) {\n          that.dropAtPointer(pointer, that.dropRadius * (big ? 1.5 : 1), big ? 0.14 : 0.01);\n        }\n      } // Start listening to pointer events\n\n\n      this.$el // Create regular, small ripples for mouse move and touch events...\n      .on('mousemove.ripples', function (e) {\n        dropAtPointer(e);\n      }).on('touchmove.ripples touchstart.ripples', function (e) {\n        var touches = e.originalEvent.changedTouches;\n\n        for (var i = 0; i < touches.length; i++) {\n          dropAtPointer(touches[i]);\n        }\n      }) // ...and only a big ripple on mouse down events.\n      .on('mousedown.ripples', function (e) {\n        dropAtPointer(e, true);\n      });\n    },\n    // Load the image either from the options or the element's CSS rules.\n    loadImage: function () {\n      var that = this;\n      gl = this.context;\n      var newImageSource = this.imageUrl || extractUrl(this.originalCssBackgroundImage) || extractUrl(this.$el.css('backgroundImage')); // If image source is unchanged, don't reload it.\n\n      if (newImageSource == this.imageSource) {\n        return;\n      }\n\n      this.imageSource = newImageSource; // Falsy source means no background.\n\n      if (!this.imageSource) {\n        this.setTransparentTexture();\n        return;\n      } // Load the texture from a new image.\n\n\n      var image = new Image();\n\n      image.onload = function () {\n        gl = that.context; // Only textures with dimensions of powers of two can have repeat wrapping.\n\n        function isPowerOfTwo(x) {\n          return (x & x - 1) == 0;\n        }\n\n        var wrapping = isPowerOfTwo(image.width) && isPowerOfTwo(image.height) ? gl.REPEAT : gl.CLAMP_TO_EDGE;\n        gl.bindTexture(gl.TEXTURE_2D, that.backgroundTexture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapping);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapping);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        that.backgroundWidth = image.width;\n        that.backgroundHeight = image.height; // Hide the background that we're replacing.\n\n        that.hideCssBackground();\n      }; // Fall back to a transparent texture when loading the image failed.\n\n\n      image.onerror = function () {\n        gl = that.context;\n        that.setTransparentTexture();\n      }; // Disable CORS when the image source is a data URI.\n\n\n      image.crossOrigin = isDataUri(this.imageSource) ? null : this.crossOrigin;\n      image.src = this.imageSource;\n    },\n    step: function () {\n      gl = this.context;\n\n      if (!this.visible) {\n        return;\n      }\n\n      this.computeTextureBoundaries();\n\n      if (this.running) {\n        this.update();\n      }\n\n      this.render();\n    },\n    drawQuad: function () {\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.quad);\n      gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n      gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);\n    },\n    render: function () {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n      gl.enable(gl.BLEND);\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n      gl.useProgram(this.renderProgram.id);\n      bindTexture(this.backgroundTexture, 0);\n      bindTexture(this.textures[0], 1);\n      gl.uniform1f(this.renderProgram.locations.perturbance, this.perturbance);\n      gl.uniform2fv(this.renderProgram.locations.topLeft, this.renderProgram.uniforms.topLeft);\n      gl.uniform2fv(this.renderProgram.locations.bottomRight, this.renderProgram.uniforms.bottomRight);\n      gl.uniform2fv(this.renderProgram.locations.containerRatio, this.renderProgram.uniforms.containerRatio);\n      gl.uniform1i(this.renderProgram.locations.samplerBackground, 0);\n      gl.uniform1i(this.renderProgram.locations.samplerRipples, 1);\n      this.drawQuad();\n      gl.disable(gl.BLEND);\n    },\n    update: function () {\n      gl.viewport(0, 0, this.resolution, this.resolution);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[this.bufferWriteIndex]);\n      bindTexture(this.textures[this.bufferReadIndex]);\n      gl.useProgram(this.updateProgram.id);\n      this.drawQuad();\n      this.swapBufferIndices();\n    },\n    swapBufferIndices: function () {\n      this.bufferWriteIndex = 1 - this.bufferWriteIndex;\n      this.bufferReadIndex = 1 - this.bufferReadIndex;\n    },\n    computeTextureBoundaries: function () {\n      var backgroundSize = this.$el.css('background-size');\n      var backgroundAttachment = this.$el.css('background-attachment');\n      var backgroundPosition = translateBackgroundPosition(this.$el.css('background-position')); // Here the 'container' is the element which the background adapts to\n      // (either the chrome window or some element, depending on attachment)\n\n      var container;\n\n      if (backgroundAttachment == 'fixed') {\n        container = {\n          left: window.pageXOffset,\n          top: window.pageYOffset\n        };\n        container.width = $window.width();\n        container.height = $window.height();\n      } else {\n        container = this.$el.offset();\n        container.width = this.$el.innerWidth();\n        container.height = this.$el.innerHeight();\n      } // TODO: background-clip\n\n\n      if (backgroundSize == 'cover') {\n        var scale = Math.max(container.width / this.backgroundWidth, container.height / this.backgroundHeight);\n        var backgroundWidth = this.backgroundWidth * scale;\n        var backgroundHeight = this.backgroundHeight * scale;\n      } else if (backgroundSize == 'contain') {\n        var scale = Math.min(container.width / this.backgroundWidth, container.height / this.backgroundHeight);\n        var backgroundWidth = this.backgroundWidth * scale;\n        var backgroundHeight = this.backgroundHeight * scale;\n      } else {\n        backgroundSize = backgroundSize.split(' ');\n        var backgroundWidth = backgroundSize[0] || '';\n        var backgroundHeight = backgroundSize[1] || backgroundWidth;\n\n        if (isPercentage(backgroundWidth)) {\n          backgroundWidth = container.width * parseFloat(backgroundWidth) / 100;\n        } else if (backgroundWidth != 'auto') {\n          backgroundWidth = parseFloat(backgroundWidth);\n        }\n\n        if (isPercentage(backgroundHeight)) {\n          backgroundHeight = container.height * parseFloat(backgroundHeight) / 100;\n        } else if (backgroundHeight != 'auto') {\n          backgroundHeight = parseFloat(backgroundHeight);\n        }\n\n        if (backgroundWidth == 'auto' && backgroundHeight == 'auto') {\n          backgroundWidth = this.backgroundWidth;\n          backgroundHeight = this.backgroundHeight;\n        } else {\n          if (backgroundWidth == 'auto') {\n            backgroundWidth = this.backgroundWidth * (backgroundHeight / this.backgroundHeight);\n          }\n\n          if (backgroundHeight == 'auto') {\n            backgroundHeight = this.backgroundHeight * (backgroundWidth / this.backgroundWidth);\n          }\n        }\n      } // Compute backgroundX and backgroundY in page coordinates\n\n\n      var backgroundX = backgroundPosition[0];\n      var backgroundY = backgroundPosition[1];\n\n      if (isPercentage(backgroundX)) {\n        backgroundX = container.left + (container.width - backgroundWidth) * parseFloat(backgroundX) / 100;\n      } else {\n        backgroundX = container.left + parseFloat(backgroundX);\n      }\n\n      if (isPercentage(backgroundY)) {\n        backgroundY = container.top + (container.height - backgroundHeight) * parseFloat(backgroundY) / 100;\n      } else {\n        backgroundY = container.top + parseFloat(backgroundY);\n      }\n\n      var elementOffset = this.$el.offset();\n      this.renderProgram.uniforms.topLeft = new Float32Array([(elementOffset.left - backgroundX) / backgroundWidth, (elementOffset.top - backgroundY) / backgroundHeight]);\n      this.renderProgram.uniforms.bottomRight = new Float32Array([this.renderProgram.uniforms.topLeft[0] + this.$el.innerWidth() / backgroundWidth, this.renderProgram.uniforms.topLeft[1] + this.$el.innerHeight() / backgroundHeight]);\n      var maxSide = Math.max(this.canvas.width, this.canvas.height);\n      this.renderProgram.uniforms.containerRatio = new Float32Array([this.canvas.width / maxSide, this.canvas.height / maxSide]);\n    },\n    initShaders: function () {\n      var vertexShader = ['attribute vec2 vertex;', 'varying vec2 coord;', 'void main() {', 'coord = vertex * 0.5 + 0.5;', 'gl_Position = vec4(vertex, 0.0, 1.0);', '}'].join('\\n');\n      this.dropProgram = createProgram(vertexShader, ['precision highp float;', 'const float PI = 3.141592653589793;', 'uniform sampler2D texture;', 'uniform vec2 center;', 'uniform float radius;', 'uniform float strength;', 'varying vec2 coord;', 'void main() {', 'vec4 info = texture2D(texture, coord);', 'float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);', 'drop = 0.5 - cos(drop * PI) * 0.5;', 'info.r += drop * strength;', 'gl_FragColor = info;', '}'].join('\\n'));\n      this.updateProgram = createProgram(vertexShader, ['precision highp float;', 'uniform sampler2D texture;', 'uniform vec2 delta;', 'varying vec2 coord;', 'void main() {', 'vec4 info = texture2D(texture, coord);', 'vec2 dx = vec2(delta.x, 0.0);', 'vec2 dy = vec2(0.0, delta.y);', 'float average = (', 'texture2D(texture, coord - dx).r +', 'texture2D(texture, coord - dy).r +', 'texture2D(texture, coord + dx).r +', 'texture2D(texture, coord + dy).r', ') * 0.25;', 'info.g += (average - info.r) * 2.0;', 'info.g *= 0.995;', 'info.r += info.g;', 'gl_FragColor = info;', '}'].join('\\n'));\n      gl.uniform2fv(this.updateProgram.locations.delta, this.textureDelta);\n      this.renderProgram = createProgram(['precision highp float;', 'attribute vec2 vertex;', 'uniform vec2 topLeft;', 'uniform vec2 bottomRight;', 'uniform vec2 containerRatio;', 'varying vec2 ripplesCoord;', 'varying vec2 backgroundCoord;', 'void main() {', 'backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);', 'backgroundCoord.y = 1.0 - backgroundCoord.y;', 'ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;', 'gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);', '}'].join('\\n'), ['precision highp float;', 'uniform sampler2D samplerBackground;', 'uniform sampler2D samplerRipples;', 'uniform vec2 delta;', 'uniform float perturbance;', 'varying vec2 ripplesCoord;', 'varying vec2 backgroundCoord;', 'void main() {', 'float height = texture2D(samplerRipples, ripplesCoord).r;', 'float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;', 'float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;', 'vec3 dx = vec3(delta.x, heightX - height, 0.0);', 'vec3 dy = vec3(0.0, heightY - height, delta.y);', 'vec2 offset = -normalize(cross(dy, dx)).xz;', 'float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);', 'gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;', '}'].join('\\n'));\n      gl.uniform2fv(this.renderProgram.locations.delta, this.textureDelta);\n    },\n    initTexture: function () {\n      this.backgroundTexture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, this.backgroundTexture);\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    },\n    setTransparentTexture: function () {\n      gl.bindTexture(gl.TEXTURE_2D, this.backgroundTexture);\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, transparentPixels);\n    },\n    hideCssBackground: function () {\n      // Check whether we're changing inline CSS or overriding a global CSS rule.\n      var inlineCss = this.$el[0].style.backgroundImage;\n\n      if (inlineCss == 'none') {\n        return;\n      }\n\n      this.originalInlineCss = inlineCss;\n      this.originalCssBackgroundImage = this.$el.css('backgroundImage');\n      this.$el.css('backgroundImage', 'none');\n    },\n    restoreCssBackground: function () {\n      // Restore background by either changing the inline CSS rule to what it was, or\n      // simply remove the inline CSS rule if it never was inlined.\n      this.$el.css('backgroundImage', this.originalInlineCss || '');\n    },\n    dropAtPointer: function (pointer, radius, strength) {\n      var borderLeft = parseInt(this.$el.css('border-left-width')) || 0,\n          borderTop = parseInt(this.$el.css('border-top-width')) || 0;\n      this.drop(pointer.pageX - this.$el.offset().left - borderLeft, pointer.pageY - this.$el.offset().top - borderTop, radius, strength);\n    },\n\n    /**\r\n     *  Public methods\r\n     */\n    drop: function (x, y, radius, strength) {\n      gl = this.context;\n      var elWidth = this.$el.innerWidth();\n      var elHeight = this.$el.innerHeight();\n      var longestSide = Math.max(elWidth, elHeight);\n      radius = radius / longestSide;\n      var dropPosition = new Float32Array([(2 * x - elWidth) / longestSide, (elHeight - 2 * y) / longestSide]);\n      gl.viewport(0, 0, this.resolution, this.resolution);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[this.bufferWriteIndex]);\n      bindTexture(this.textures[this.bufferReadIndex]);\n      gl.useProgram(this.dropProgram.id);\n      gl.uniform2fv(this.dropProgram.locations.center, dropPosition);\n      gl.uniform1f(this.dropProgram.locations.radius, radius);\n      gl.uniform1f(this.dropProgram.locations.strength, strength);\n      this.drawQuad();\n      this.swapBufferIndices();\n    },\n    updateSize: function () {\n      var newWidth = this.$el.innerWidth(),\n          newHeight = this.$el.innerHeight();\n\n      if (newWidth != this.canvas.width || newHeight != this.canvas.height) {\n        this.canvas.width = newWidth;\n        this.canvas.height = newHeight;\n      }\n    },\n    destroy: function () {\n      this.$el.off('.ripples').removeClass('jquery-ripples').removeData('ripples'); // Make sure the last used context is garbage-collected\n\n      gl = null;\n      $(window).off('resize', this.updateSize);\n      this.$canvas.remove();\n      this.restoreCssBackground();\n      this.destroyed = true;\n    },\n    show: function () {\n      this.visible = true;\n      this.$canvas.show();\n      this.hideCssBackground();\n    },\n    hide: function () {\n      this.visible = false;\n      this.$canvas.hide();\n      this.restoreCssBackground();\n    },\n    pause: function () {\n      this.running = false;\n    },\n    play: function () {\n      this.running = true;\n    },\n    set: function (property, value) {\n      switch (property) {\n        case 'dropRadius':\n        case 'perturbance':\n        case 'interactive':\n        case 'crossOrigin':\n          this[property] = value;\n          break;\n\n        case 'imageUrl':\n          this.imageUrl = value;\n          this.loadImage();\n          break;\n      }\n    }\n  }; // RIPPLES PLUGIN DEFINITION\n  // ==========================\n\n  var old = $.fn.ripples;\n\n  $.fn.ripples = function (option) {\n    if (!config) {\n      throw new Error('Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.');\n    }\n\n    var args = arguments.length > 1 ? Array.prototype.slice.call(arguments, 1) : undefined;\n    return this.each(function () {\n      var $this = $(this),\n          data = $this.data('ripples'),\n          options = $.extend({}, Ripples.DEFAULTS, $this.data(), typeof option == 'object' && option);\n\n      if (!data && typeof option == 'string') {\n        return;\n      }\n\n      if (!data) {\n        $this.data('ripples', data = new Ripples(this, options));\n      } else if (typeof option == 'string') {\n        Ripples.prototype[option].apply(data, args);\n      }\n    });\n  };\n\n  $.fn.ripples.Constructor = Ripples; // RIPPLES NO CONFLICT\n  // ====================\n\n  $.fn.ripples.noConflict = function () {\n    $.fn.ripples = old;\n    return this;\n  };\n});","map":{"version":3,"sources":["/Users/shiziwizi/Desktop/finalProjectCloud/john/node_modules/jquery.ripples/dist/jquery.ripples.js"],"names":["global","factory","exports","module","require","define","amd","$","gl","$window","window","isPercentage","str","length","loadConfig","canvas","document","createElement","getContext","extensions","forEach","name","extension","getExtension","OES_texture_float","configs","createConfig","type","glType","arrayType","nameLinear","linearSupport","configExtensions","push","FLOAT","Float32Array","OES_texture_half_float","HALF_FLOAT_OES","texture","createTexture","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","config","i","texImage2D","RGBA","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","createImageData","width","height","ImageData","e","translateBackgroundPosition","value","parts","split","map","part","createProgram","vertexSource","fragmentSource","uniformValues","compileSource","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","Error","getShaderInfoLog","program","id","attachShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniforms","locations","useProgram","enableVertexAttribArray","match","regex","shaderCode","exec","getUniformLocation","unit","activeTexture","TEXTURE0","extractUrl","urlMatch","isDataUri","url","transparentPixels","prepend","Ripples","el","options","that","$el","interactive","resolution","textureDelta","perturbance","dropRadius","crossOrigin","imageUrl","innerWidth","innerHeight","$canvas","css","position","left","top","right","bottom","zIndex","addClass","append","context","updateSize","bind","on","textures","framebuffers","bufferWriteIndex","bufferReadIndex","textureData","LINEAR","quad","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","initShaders","initTexture","setTransparentTexture","loadImage","clearColor","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","visible","running","inited","destroyed","setupPointerEvents","step","requestAnimationFrame","DEFAULTS","prototype","pointerEventsEnabled","dropAtPointer","pointer","big","touches","originalEvent","changedTouches","newImageSource","originalCssBackgroundImage","imageSource","image","Image","onload","isPowerOfTwo","x","wrapping","REPEAT","backgroundTexture","UNSIGNED_BYTE","backgroundWidth","backgroundHeight","hideCssBackground","onerror","src","computeTextureBoundaries","update","render","drawQuad","vertexAttribPointer","drawArrays","TRIANGLE_FAN","viewport","enable","BLEND","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","renderProgram","uniform1f","uniform2fv","topLeft","bottomRight","containerRatio","uniform1i","samplerBackground","samplerRipples","disable","updateProgram","swapBufferIndices","backgroundSize","backgroundAttachment","backgroundPosition","container","pageXOffset","pageYOffset","offset","scale","Math","max","min","parseFloat","backgroundX","backgroundY","elementOffset","maxSide","vertexShader","join","dropProgram","delta","pixelStorei","UNPACK_FLIP_Y_WEBGL","inlineCss","style","backgroundImage","originalInlineCss","restoreCssBackground","radius","strength","borderLeft","parseInt","borderTop","drop","pageX","pageY","y","elWidth","elHeight","longestSide","dropPosition","center","newWidth","newHeight","destroy","off","removeClass","removeData","remove","show","hide","pause","play","set","property","old","fn","ripples","option","args","arguments","Array","slice","call","undefined","each","$this","data","extend","apply","Constructor","noConflict"],"mappings":"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","sourcesContent":["/**\n * jQuery Ripples plugin v0.6.3 / https://github.com/sirxemic/jquery.ripples\n * MIT License\n * @author sirxemic / https://sirxemic.com/\n */\n\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(require('jquery')) :\n\ttypeof define === 'function' && define.amd ? define(['jquery'], factory) :\n\t(factory(global.$));\n}(this, (function ($) { 'use strict';\n\n$ = $ && 'default' in $ ? $['default'] : $;\n\nvar gl;\r\nvar $window = $(window); // There is only one window, so why not cache the jQuery-wrapped window?\r\n\r\nfunction isPercentage(str) {\r\n\treturn str[str.length - 1] == '%';\r\n}\r\n\r\n/**\r\n *  Load a configuration of GL settings which the browser supports.\r\n *  For example:\r\n *  - not all browsers support WebGL\r\n *  - not all browsers support floating point textures\r\n *  - not all browsers support linear filtering for floating point textures\r\n *  - not all browsers support rendering to floating point textures\r\n *  - some browsers *do* support rendering to half-floating point textures instead.\r\n */\r\nfunction loadConfig() {\r\n\tvar canvas = document.createElement('canvas');\r\n\tgl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n\r\n\tif (!gl) {\r\n\t\t// Browser does not support WebGL.\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Load extensions\r\n\tvar extensions = {};\r\n\t[\r\n\t\t'OES_texture_float',\r\n\t\t'OES_texture_half_float',\r\n\t\t'OES_texture_float_linear',\r\n\t\t'OES_texture_half_float_linear'\r\n\t].forEach(function(name) {\r\n\t\tvar extension = gl.getExtension(name);\r\n\t\tif (extension) {\r\n\t\t\textensions[name] = extension;\r\n\t\t}\r\n\t});\r\n\r\n\t// If no floating point extensions are supported we can bail out early.\r\n\tif (!extensions.OES_texture_float) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar configs = [];\r\n\r\n\tfunction createConfig(type, glType, arrayType) {\r\n\t\tvar name = 'OES_texture_' + type,\r\n\t\t\t\tnameLinear = name + '_linear',\r\n\t\t\t\tlinearSupport = nameLinear in extensions,\r\n\t\t\t\tconfigExtensions = [name];\r\n\r\n\t\tif (linearSupport) {\r\n\t\t\tconfigExtensions.push(nameLinear);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: glType,\r\n\t\t\tarrayType: arrayType,\r\n\t\t\tlinearSupport: linearSupport,\r\n\t\t\textensions: configExtensions\r\n\t\t};\r\n\t}\r\n\r\n\tconfigs.push(\r\n\t\tcreateConfig('float', gl.FLOAT, Float32Array)\r\n\t);\r\n\r\n\tif (extensions.OES_texture_half_float) {\r\n\t\tconfigs.push(\r\n\t\t\t// Array type should be Uint16Array, but at least on iOS that breaks. In that case we\r\n\t\t\t// just initialize the textures with data=null, instead of data=new Uint16Array(...).\r\n\t\t\t// This makes initialization a tad slower, but it's still negligible.\r\n\t\t\tcreateConfig('half_float', extensions.OES_texture_half_float.HALF_FLOAT_OES, null)\r\n\t\t);\r\n\t}\r\n\r\n\t// Setup the texture and framebuffer\r\n\tvar texture = gl.createTexture();\r\n\tvar framebuffer = gl.createFramebuffer();\r\n\r\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n\t// Check for each supported texture type if rendering to it is supported\r\n\tvar config = null;\r\n\r\n\tfor (var i = 0; i < configs.length; i++) {\r\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 32, 32, 0, gl.RGBA, configs[i].type, null);\r\n\r\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n\t\tif (gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE) {\r\n\t\t\tconfig = configs[i];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn config;\r\n}\r\n\r\nfunction createImageData(width, height) {\r\n\ttry {\r\n\t\treturn new ImageData(width, height);\r\n\t}\r\n\tcatch (e) {\r\n\t\t// Fallback for IE\r\n\t\tvar canvas = document.createElement('canvas');\r\n\t\treturn canvas.getContext('2d').createImageData(width, height);\r\n\t}\r\n}\r\n\r\nfunction translateBackgroundPosition(value) {\r\n\tvar parts = value.split(' ');\r\n\r\n\tif (parts.length === 1) {\r\n\t\tswitch (value) {\r\n\t\t\tcase 'center':\r\n\t\t\t\treturn ['50%', '50%'];\r\n\t\t\tcase 'top':\r\n\t\t\t\treturn ['50%', '0'];\r\n\t\t\tcase 'bottom':\r\n\t\t\t\treturn ['50%', '100%'];\r\n\t\t\tcase 'left':\r\n\t\t\t\treturn ['0', '50%'];\r\n\t\t\tcase 'right':\r\n\t\t\t\treturn ['100%', '50%'];\r\n\t\t\tdefault:\r\n\t\t\t\treturn [value, '50%'];\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\treturn parts.map(function(part) {\r\n\t\t\tswitch (value) {\r\n\t\t\t\tcase 'center':\r\n\t\t\t\t\treturn '50%';\r\n\t\t\t\tcase 'top':\r\n\t\t\t\tcase 'left':\r\n\t\t\t\t\treturn '0';\r\n\t\t\t\tcase 'right':\r\n\t\t\t\tcase 'bottom':\r\n\t\t\t\t\treturn '100%';\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn part;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction createProgram(vertexSource, fragmentSource, uniformValues) {\r\n\tfunction compileSource(type, source) {\r\n\t\tvar shader = gl.createShader(type);\r\n\t\tgl.shaderSource(shader, source);\r\n\t\tgl.compileShader(shader);\r\n\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n\t\t\tthrow new Error('compile error: ' + gl.getShaderInfoLog(shader));\r\n\t\t}\r\n\t\treturn shader;\r\n\t}\r\n\r\n\tvar program = {};\r\n\r\n\tprogram.id = gl.createProgram();\r\n\tgl.attachShader(program.id, compileSource(gl.VERTEX_SHADER, vertexSource));\r\n\tgl.attachShader(program.id, compileSource(gl.FRAGMENT_SHADER, fragmentSource));\r\n\tgl.linkProgram(program.id);\r\n\tif (!gl.getProgramParameter(program.id, gl.LINK_STATUS)) {\r\n\t\tthrow new Error('link error: ' + gl.getProgramInfoLog(program.id));\r\n\t}\r\n\r\n\t// Fetch the uniform and attribute locations\r\n\tprogram.uniforms = {};\r\n\tprogram.locations = {};\r\n\tgl.useProgram(program.id);\r\n\tgl.enableVertexAttribArray(0);\r\n\tvar match, name, regex = /uniform (\\w+) (\\w+)/g, shaderCode = vertexSource + fragmentSource;\r\n\twhile ((match = regex.exec(shaderCode)) != null) {\r\n\t\tname = match[2];\r\n\t\tprogram.locations[name] = gl.getUniformLocation(program.id, name);\r\n\t}\r\n\r\n\treturn program;\r\n}\r\n\r\nfunction bindTexture(texture, unit) {\r\n\tgl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\r\n}\r\n\r\nfunction extractUrl(value) {\r\n\tvar urlMatch = /url\\([\"']?([^\"']*)[\"']?\\)/.exec(value);\r\n\tif (urlMatch == null) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn urlMatch[1];\r\n}\r\n\r\nfunction isDataUri(url) {\r\n\treturn url.match(/^data:/);\r\n}\r\n\r\nvar config = loadConfig();\r\nvar transparentPixels = createImageData(32, 32);\r\n\r\n// Extend the css\r\n$('head').prepend('<style>.jquery-ripples { position: relative; z-index: 0; }</style>');\r\n\r\n// RIPPLES CLASS DEFINITION\r\n// =========================\r\n\r\nvar Ripples = function (el, options) {\r\n\tvar that = this;\r\n\r\n\tthis.$el = $(el);\r\n\r\n\t// Init properties from options\r\n\tthis.interactive = options.interactive;\r\n\tthis.resolution = options.resolution;\r\n\tthis.textureDelta = new Float32Array([1 / this.resolution, 1 / this.resolution]);\r\n\r\n\tthis.perturbance = options.perturbance;\r\n\tthis.dropRadius = options.dropRadius;\r\n\r\n\tthis.crossOrigin = options.crossOrigin;\r\n\tthis.imageUrl = options.imageUrl;\r\n\r\n\t// Init WebGL canvas\r\n\tvar canvas = document.createElement('canvas');\r\n\tcanvas.width = this.$el.innerWidth();\r\n\tcanvas.height = this.$el.innerHeight();\r\n\tthis.canvas = canvas;\r\n\tthis.$canvas = $(canvas);\r\n\tthis.$canvas.css({\r\n\t\tposition: 'absolute',\r\n\t\tleft: 0,\r\n\t\ttop: 0,\r\n\t\tright: 0,\r\n\t\tbottom: 0,\r\n\t\tzIndex: -1\r\n\t});\r\n\r\n\tthis.$el.addClass('jquery-ripples').append(canvas);\r\n\tthis.context = gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n\r\n\t// Load extensions\r\n\tconfig.extensions.forEach(function(name) {\r\n\t\tgl.getExtension(name);\r\n\t});\r\n\r\n\t// Auto-resize when window size changes.\r\n\tthis.updateSize = this.updateSize.bind(this);\r\n\t$(window).on('resize', this.updateSize);\r\n\r\n\t// Init rendertargets for ripple data.\r\n\tthis.textures = [];\r\n\tthis.framebuffers = [];\r\n\tthis.bufferWriteIndex = 0;\r\n\tthis.bufferReadIndex = 1;\r\n\r\n\tvar arrayType = config.arrayType;\r\n\tvar textureData = arrayType ? new arrayType(this.resolution * this.resolution * 4) : null;\r\n\r\n\tfor (var i = 0; i < 2; i++) {\r\n\t\tvar texture = gl.createTexture();\r\n\t\tvar framebuffer = gl.createFramebuffer();\r\n\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, config.linearSupport ? gl.LINEAR : gl.NEAREST);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, config.linearSupport ? gl.LINEAR : gl.NEAREST);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.resolution, this.resolution, 0, gl.RGBA, config.type, textureData);\r\n\r\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n\r\n\t\tthis.textures.push(texture);\r\n\t\tthis.framebuffers.push(framebuffer);\r\n\t}\r\n\r\n\t// Init GL stuff\r\n\tthis.quad = gl.createBuffer();\r\n\tgl.bindBuffer(gl.ARRAY_BUFFER, this.quad);\r\n\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\r\n\t\t-1, -1,\r\n\t\t+1, -1,\r\n\t\t+1, +1,\r\n\t\t-1, +1\r\n\t]), gl.STATIC_DRAW);\r\n\r\n\tthis.initShaders();\r\n\tthis.initTexture();\r\n\tthis.setTransparentTexture();\r\n\r\n\t// Load the image either from the options or CSS rules\r\n\tthis.loadImage();\r\n\r\n\t// Set correct clear color and blend mode (regular alpha blending)\r\n\tgl.clearColor(0, 0, 0, 0);\r\n\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n\t// Plugin is successfully initialized!\r\n\tthis.visible = true;\r\n\tthis.running = true;\r\n\tthis.inited = true;\r\n\tthis.destroyed = false;\r\n\r\n\tthis.setupPointerEvents();\r\n\r\n\t// Init animation\r\n\tfunction step() {\r\n\t\tif (!that.destroyed) {\r\n\t\t\tthat.step();\r\n\r\n\t\t\trequestAnimationFrame(step);\r\n\t\t}\r\n\t}\r\n\r\n\trequestAnimationFrame(step);\r\n};\r\n\r\nRipples.DEFAULTS = {\r\n\timageUrl: null,\r\n\tresolution: 256,\r\n\tdropRadius: 20,\r\n\tperturbance: 0.03,\r\n\tinteractive: true,\r\n\tcrossOrigin: ''\r\n};\r\n\r\nRipples.prototype = {\r\n\r\n\t// Set up pointer (mouse + touch) events\r\n\tsetupPointerEvents: function() {\r\n\t\tvar that = this;\r\n\r\n\t\tfunction pointerEventsEnabled() {\r\n\t\t\treturn that.visible && that.running && that.interactive;\r\n\t\t}\r\n\r\n\t\tfunction dropAtPointer(pointer, big) {\r\n\t\t\tif (pointerEventsEnabled()) {\r\n\t\t\t\tthat.dropAtPointer(\r\n\t\t\t\t\tpointer,\r\n\t\t\t\t\tthat.dropRadius * (big ? 1.5 : 1),\r\n\t\t\t\t\t(big ? 0.14 : 0.01)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Start listening to pointer events\r\n\t\tthis.$el\r\n\r\n\t\t\t// Create regular, small ripples for mouse move and touch events...\r\n\t\t\t.on('mousemove.ripples', function(e) {\r\n\t\t\t\tdropAtPointer(e);\r\n\t\t\t})\r\n\t\t\t.on('touchmove.ripples touchstart.ripples', function(e) {\r\n\t\t\t\tvar touches = e.originalEvent.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tdropAtPointer(touches[i]);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\t// ...and only a big ripple on mouse down events.\r\n\t\t\t.on('mousedown.ripples', function(e) {\r\n\t\t\t\tdropAtPointer(e, true);\r\n\t\t\t});\r\n\t},\r\n\r\n\t// Load the image either from the options or the element's CSS rules.\r\n\tloadImage: function() {\r\n\t\tvar that = this;\r\n\r\n\t\tgl = this.context;\r\n\r\n\t\tvar newImageSource = this.imageUrl ||\r\n\t\t\textractUrl(this.originalCssBackgroundImage) ||\r\n\t\t\textractUrl(this.$el.css('backgroundImage'));\r\n\r\n\t\t// If image source is unchanged, don't reload it.\r\n\t\tif (newImageSource == this.imageSource) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.imageSource = newImageSource;\r\n\r\n\t\t// Falsy source means no background.\r\n\t\tif (!this.imageSource) {\r\n\t\t\tthis.setTransparentTexture();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Load the texture from a new image.\r\n\t\tvar image = new Image;\r\n\t\timage.onload = function() {\r\n\t\t\tgl = that.context;\r\n\r\n\t\t\t// Only textures with dimensions of powers of two can have repeat wrapping.\r\n\t\t\tfunction isPowerOfTwo(x) {\r\n\t\t\t\treturn (x & (x - 1)) == 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar wrapping = (isPowerOfTwo(image.width) && isPowerOfTwo(image.height)) ? gl.REPEAT : gl.CLAMP_TO_EDGE;\r\n\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, that.backgroundTexture);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapping);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapping);\r\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\r\n\t\t\tthat.backgroundWidth = image.width;\r\n\t\t\tthat.backgroundHeight = image.height;\r\n\r\n\t\t\t// Hide the background that we're replacing.\r\n\t\t\tthat.hideCssBackground();\r\n\t\t};\r\n\r\n\t\t// Fall back to a transparent texture when loading the image failed.\r\n\t\timage.onerror = function() {\r\n\t\t\tgl = that.context;\r\n\r\n\t\t\tthat.setTransparentTexture();\r\n\t\t};\r\n\r\n\t\t// Disable CORS when the image source is a data URI.\r\n\t\timage.crossOrigin = isDataUri(this.imageSource) ? null : this.crossOrigin;\r\n\r\n\t\timage.src = this.imageSource;\r\n\t},\r\n\r\n\tstep: function() {\r\n\t\tgl = this.context;\r\n\r\n\t\tif (!this.visible) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.computeTextureBoundaries();\r\n\r\n\t\tif (this.running) {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\t},\r\n\r\n\tdrawQuad: function() {\r\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.quad);\r\n\t\tgl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\t\tgl.drawArrays(gl.TRIANGLE_FAN, 0, 4);\r\n\t},\r\n\r\n\trender: function() {\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n\t\tgl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n\t\tgl.enable(gl.BLEND);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n\t\tgl.useProgram(this.renderProgram.id);\r\n\r\n\t\tbindTexture(this.backgroundTexture, 0);\r\n\t\tbindTexture(this.textures[0], 1);\r\n\r\n\t\tgl.uniform1f(this.renderProgram.locations.perturbance, this.perturbance);\r\n\t\tgl.uniform2fv(this.renderProgram.locations.topLeft, this.renderProgram.uniforms.topLeft);\r\n\t\tgl.uniform2fv(this.renderProgram.locations.bottomRight, this.renderProgram.uniforms.bottomRight);\r\n\t\tgl.uniform2fv(this.renderProgram.locations.containerRatio, this.renderProgram.uniforms.containerRatio);\r\n\t\tgl.uniform1i(this.renderProgram.locations.samplerBackground, 0);\r\n\t\tgl.uniform1i(this.renderProgram.locations.samplerRipples, 1);\r\n\r\n\t\tthis.drawQuad();\r\n\t\tgl.disable(gl.BLEND);\r\n\t},\r\n\r\n\tupdate: function() {\r\n\t\tgl.viewport(0, 0, this.resolution, this.resolution);\r\n\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[this.bufferWriteIndex]);\r\n\t\tbindTexture(this.textures[this.bufferReadIndex]);\r\n\t\tgl.useProgram(this.updateProgram.id);\r\n\r\n\t\tthis.drawQuad();\r\n\r\n\t\tthis.swapBufferIndices();\r\n\t},\r\n\r\n\tswapBufferIndices: function() {\r\n\t\tthis.bufferWriteIndex = 1 - this.bufferWriteIndex;\r\n\t\tthis.bufferReadIndex = 1 - this.bufferReadIndex;\r\n\t},\r\n\r\n\tcomputeTextureBoundaries: function() {\r\n\t\tvar backgroundSize = this.$el.css('background-size');\r\n\t\tvar backgroundAttachment = this.$el.css('background-attachment');\r\n\t\tvar backgroundPosition = translateBackgroundPosition(this.$el.css('background-position'));\r\n\r\n\t\t// Here the 'container' is the element which the background adapts to\r\n\t\t// (either the chrome window or some element, depending on attachment)\r\n\t\tvar container;\r\n\t\tif (backgroundAttachment == 'fixed') {\r\n\t\t\tcontainer = { left: window.pageXOffset, top: window.pageYOffset };\r\n\t\t\tcontainer.width = $window.width();\r\n\t\t\tcontainer.height = $window.height();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcontainer = this.$el.offset();\r\n\t\t\tcontainer.width = this.$el.innerWidth();\r\n\t\t\tcontainer.height = this.$el.innerHeight();\r\n\t\t}\r\n\r\n\t\t// TODO: background-clip\r\n\t\tif (backgroundSize == 'cover') {\r\n\t\t\tvar scale = Math.max(container.width / this.backgroundWidth, container.height / this.backgroundHeight);\r\n\r\n\t\t\tvar backgroundWidth = this.backgroundWidth * scale;\r\n\t\t\tvar backgroundHeight = this.backgroundHeight * scale;\r\n\t\t}\r\n\t\telse if (backgroundSize == 'contain') {\r\n\t\t\tvar scale = Math.min(container.width / this.backgroundWidth, container.height / this.backgroundHeight);\r\n\r\n\t\t\tvar backgroundWidth = this.backgroundWidth * scale;\r\n\t\t\tvar backgroundHeight = this.backgroundHeight * scale;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbackgroundSize = backgroundSize.split(' ');\r\n\t\t\tvar backgroundWidth = backgroundSize[0] || '';\r\n\t\t\tvar backgroundHeight = backgroundSize[1] || backgroundWidth;\r\n\r\n\t\t\tif (isPercentage(backgroundWidth)) {\r\n\t\t\t\tbackgroundWidth = container.width * parseFloat(backgroundWidth) / 100;\r\n\t\t\t}\r\n\t\t\telse if (backgroundWidth != 'auto') {\r\n\t\t\t\tbackgroundWidth = parseFloat(backgroundWidth);\r\n\t\t\t}\r\n\r\n\t\t\tif (isPercentage(backgroundHeight)) {\r\n\t\t\t\tbackgroundHeight = container.height * parseFloat(backgroundHeight) / 100;\r\n\t\t\t}\r\n\t\t\telse if (backgroundHeight != 'auto') {\r\n\t\t\t\tbackgroundHeight = parseFloat(backgroundHeight);\r\n\t\t\t}\r\n\r\n\t\t\tif (backgroundWidth == 'auto' && backgroundHeight == 'auto') {\r\n\t\t\t\tbackgroundWidth = this.backgroundWidth;\r\n\t\t\t\tbackgroundHeight = this.backgroundHeight;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (backgroundWidth == 'auto') {\r\n\t\t\t\t\tbackgroundWidth = this.backgroundWidth * (backgroundHeight / this.backgroundHeight);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (backgroundHeight == 'auto') {\r\n\t\t\t\t\tbackgroundHeight = this.backgroundHeight * (backgroundWidth / this.backgroundWidth);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Compute backgroundX and backgroundY in page coordinates\r\n\t\tvar backgroundX = backgroundPosition[0];\r\n\t\tvar backgroundY = backgroundPosition[1];\r\n\r\n\t\tif (isPercentage(backgroundX)) {\r\n\t\t\tbackgroundX = container.left + (container.width - backgroundWidth) * parseFloat(backgroundX) / 100;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbackgroundX = container.left + parseFloat(backgroundX);\r\n\t\t}\r\n\r\n\t\tif (isPercentage(backgroundY)) {\r\n\t\t\tbackgroundY = container.top + (container.height - backgroundHeight) * parseFloat(backgroundY) / 100;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbackgroundY = container.top + parseFloat(backgroundY);\r\n\t\t}\r\n\r\n\t\tvar elementOffset = this.$el.offset();\r\n\r\n\t\tthis.renderProgram.uniforms.topLeft = new Float32Array([\r\n\t\t\t(elementOffset.left - backgroundX) / backgroundWidth,\r\n\t\t\t(elementOffset.top - backgroundY) / backgroundHeight\r\n\t\t]);\r\n\t\tthis.renderProgram.uniforms.bottomRight = new Float32Array([\r\n\t\t\tthis.renderProgram.uniforms.topLeft[0] + this.$el.innerWidth() / backgroundWidth,\r\n\t\t\tthis.renderProgram.uniforms.topLeft[1] + this.$el.innerHeight() / backgroundHeight\r\n\t\t]);\r\n\r\n\t\tvar maxSide = Math.max(this.canvas.width, this.canvas.height);\r\n\r\n\t\tthis.renderProgram.uniforms.containerRatio = new Float32Array([\r\n\t\t\tthis.canvas.width / maxSide,\r\n\t\t\tthis.canvas.height / maxSide\r\n\t\t]);\r\n\t},\r\n\r\n\tinitShaders: function() {\r\n\t\tvar vertexShader = [\r\n\t\t\t'attribute vec2 vertex;',\r\n\t\t\t'varying vec2 coord;',\r\n\t\t\t'void main() {',\r\n\t\t\t\t'coord = vertex * 0.5 + 0.5;',\r\n\t\t\t\t'gl_Position = vec4(vertex, 0.0, 1.0);',\r\n\t\t\t'}'\r\n\t\t].join('\\n');\r\n\r\n\t\tthis.dropProgram = createProgram(vertexShader, [\r\n\t\t\t'precision highp float;',\r\n\r\n\t\t\t'const float PI = 3.141592653589793;',\r\n\t\t\t'uniform sampler2D texture;',\r\n\t\t\t'uniform vec2 center;',\r\n\t\t\t'uniform float radius;',\r\n\t\t\t'uniform float strength;',\r\n\r\n\t\t\t'varying vec2 coord;',\r\n\r\n\t\t\t'void main() {',\r\n\t\t\t\t'vec4 info = texture2D(texture, coord);',\r\n\r\n\t\t\t\t'float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);',\r\n\t\t\t\t'drop = 0.5 - cos(drop * PI) * 0.5;',\r\n\r\n\t\t\t\t'info.r += drop * strength;',\r\n\r\n\t\t\t\t'gl_FragColor = info;',\r\n\t\t\t'}'\r\n\t\t].join('\\n'));\r\n\r\n\t\tthis.updateProgram = createProgram(vertexShader, [\r\n\t\t\t'precision highp float;',\r\n\r\n\t\t\t'uniform sampler2D texture;',\r\n\t\t\t'uniform vec2 delta;',\r\n\r\n\t\t\t'varying vec2 coord;',\r\n\r\n\t\t\t'void main() {',\r\n\t\t\t\t'vec4 info = texture2D(texture, coord);',\r\n\r\n\t\t\t\t'vec2 dx = vec2(delta.x, 0.0);',\r\n\t\t\t\t'vec2 dy = vec2(0.0, delta.y);',\r\n\r\n\t\t\t\t'float average = (',\r\n\t\t\t\t\t'texture2D(texture, coord - dx).r +',\r\n\t\t\t\t\t'texture2D(texture, coord - dy).r +',\r\n\t\t\t\t\t'texture2D(texture, coord + dx).r +',\r\n\t\t\t\t\t'texture2D(texture, coord + dy).r',\r\n\t\t\t\t') * 0.25;',\r\n\r\n\t\t\t\t'info.g += (average - info.r) * 2.0;',\r\n\t\t\t\t'info.g *= 0.995;',\r\n\t\t\t\t'info.r += info.g;',\r\n\r\n\t\t\t\t'gl_FragColor = info;',\r\n\t\t\t'}'\r\n\t\t].join('\\n'));\r\n\t\tgl.uniform2fv(this.updateProgram.locations.delta, this.textureDelta);\r\n\r\n\t\tthis.renderProgram = createProgram([\r\n\t\t\t'precision highp float;',\r\n\r\n\t\t\t'attribute vec2 vertex;',\r\n\t\t\t'uniform vec2 topLeft;',\r\n\t\t\t'uniform vec2 bottomRight;',\r\n\t\t\t'uniform vec2 containerRatio;',\r\n\t\t\t'varying vec2 ripplesCoord;',\r\n\t\t\t'varying vec2 backgroundCoord;',\r\n\t\t\t'void main() {',\r\n\t\t\t\t'backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);',\r\n\t\t\t\t'backgroundCoord.y = 1.0 - backgroundCoord.y;',\r\n\t\t\t\t'ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;',\r\n\t\t\t\t'gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);',\r\n\t\t\t'}'\r\n\t\t].join('\\n'), [\r\n\t\t\t'precision highp float;',\r\n\r\n\t\t\t'uniform sampler2D samplerBackground;',\r\n\t\t\t'uniform sampler2D samplerRipples;',\r\n\t\t\t'uniform vec2 delta;',\r\n\r\n\t\t\t'uniform float perturbance;',\r\n\t\t\t'varying vec2 ripplesCoord;',\r\n\t\t\t'varying vec2 backgroundCoord;',\r\n\r\n\t\t\t'void main() {',\r\n\t\t\t\t'float height = texture2D(samplerRipples, ripplesCoord).r;',\r\n\t\t\t\t'float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;',\r\n\t\t\t\t'float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;',\r\n\t\t\t\t'vec3 dx = vec3(delta.x, heightX - height, 0.0);',\r\n\t\t\t\t'vec3 dy = vec3(0.0, heightY - height, delta.y);',\r\n\t\t\t\t'vec2 offset = -normalize(cross(dy, dx)).xz;',\r\n\t\t\t\t'float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);',\r\n\t\t\t\t'gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;',\r\n\t\t\t'}'\r\n\t\t].join('\\n'));\r\n\t\tgl.uniform2fv(this.renderProgram.locations.delta, this.textureDelta);\r\n\t},\r\n\r\n\tinitTexture: function() {\r\n\t\tthis.backgroundTexture = gl.createTexture();\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.backgroundTexture);\r\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n\t},\r\n\r\n\tsetTransparentTexture: function() {\r\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.backgroundTexture);\r\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, transparentPixels);\r\n\t},\r\n\r\n\thideCssBackground: function() {\r\n\r\n\t\t// Check whether we're changing inline CSS or overriding a global CSS rule.\r\n\t\tvar inlineCss = this.$el[0].style.backgroundImage;\r\n\r\n\t\tif (inlineCss == 'none') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.originalInlineCss = inlineCss;\r\n\r\n\t\tthis.originalCssBackgroundImage = this.$el.css('backgroundImage');\r\n\t\tthis.$el.css('backgroundImage', 'none');\r\n\t},\r\n\r\n\trestoreCssBackground: function() {\r\n\r\n\t\t// Restore background by either changing the inline CSS rule to what it was, or\r\n\t\t// simply remove the inline CSS rule if it never was inlined.\r\n\t\tthis.$el.css('backgroundImage', this.originalInlineCss || '');\r\n\t},\r\n\r\n\tdropAtPointer: function(pointer, radius, strength) {\r\n\t\tvar borderLeft = parseInt(this.$el.css('border-left-width')) || 0,\r\n\t\t\t\tborderTop = parseInt(this.$el.css('border-top-width')) || 0;\r\n\r\n\t\tthis.drop(\r\n\t\t\tpointer.pageX - this.$el.offset().left - borderLeft,\r\n\t\t\tpointer.pageY - this.$el.offset().top - borderTop,\r\n\t\t\tradius,\r\n\t\t\tstrength\r\n\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t *  Public methods\r\n\t */\r\n\tdrop: function(x, y, radius, strength) {\r\n\t\tgl = this.context;\r\n\r\n\t\tvar elWidth = this.$el.innerWidth();\r\n\t\tvar elHeight = this.$el.innerHeight();\r\n\t\tvar longestSide = Math.max(elWidth, elHeight);\r\n\r\n\t\tradius = radius / longestSide;\r\n\r\n\t\tvar dropPosition = new Float32Array([\r\n\t\t\t(2 * x - elWidth) / longestSide,\r\n\t\t\t(elHeight - 2 * y) / longestSide\r\n\t\t]);\r\n\r\n\t\tgl.viewport(0, 0, this.resolution, this.resolution);\r\n\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[this.bufferWriteIndex]);\r\n\t\tbindTexture(this.textures[this.bufferReadIndex]);\r\n\r\n\t\tgl.useProgram(this.dropProgram.id);\r\n\t\tgl.uniform2fv(this.dropProgram.locations.center, dropPosition);\r\n\t\tgl.uniform1f(this.dropProgram.locations.radius, radius);\r\n\t\tgl.uniform1f(this.dropProgram.locations.strength, strength);\r\n\r\n\t\tthis.drawQuad();\r\n\r\n\t\tthis.swapBufferIndices();\r\n\t},\r\n\r\n\tupdateSize: function() {\r\n\t\tvar newWidth = this.$el.innerWidth(),\r\n\t\t\t\tnewHeight = this.$el.innerHeight();\r\n\r\n\t\tif (newWidth != this.canvas.width || newHeight != this.canvas.height) {\r\n\t\t\tthis.canvas.width = newWidth;\r\n\t\t\tthis.canvas.height = newHeight;\r\n\t\t}\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\tthis.$el\r\n\t\t\t.off('.ripples')\r\n\t\t\t.removeClass('jquery-ripples')\r\n\t\t\t.removeData('ripples');\r\n\r\n\t\t// Make sure the last used context is garbage-collected\r\n\t\tgl = null;\r\n\r\n\t\t$(window).off('resize', this.updateSize);\r\n\r\n\t\tthis.$canvas.remove();\r\n\t\tthis.restoreCssBackground();\r\n\r\n\t\tthis.destroyed = true;\r\n\t},\r\n\r\n\tshow: function() {\r\n\t\tthis.visible = true;\r\n\r\n\t\tthis.$canvas.show();\r\n\t\tthis.hideCssBackground();\r\n\t},\r\n\r\n\thide: function() {\r\n\t\tthis.visible = false;\r\n\r\n\t\tthis.$canvas.hide();\r\n\t\tthis.restoreCssBackground();\r\n\t},\r\n\r\n\tpause: function() {\r\n\t\tthis.running = false;\r\n\t},\r\n\r\n\tplay: function() {\r\n\t\tthis.running = true;\r\n\t},\r\n\r\n\tset: function(property, value) {\r\n\t\tswitch (property) {\r\n\t\t\tcase 'dropRadius':\r\n\t\t\tcase 'perturbance':\r\n\t\t\tcase 'interactive':\r\n\t\t\tcase 'crossOrigin':\r\n\t\t\t\tthis[property] = value;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'imageUrl':\r\n\t\t\t\tthis.imageUrl = value;\r\n\t\t\t\tthis.loadImage();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// RIPPLES PLUGIN DEFINITION\r\n// ==========================\r\n\r\nvar old = $.fn.ripples;\r\n\r\n$.fn.ripples = function(option) {\r\n\tif (!config) {\r\n\t\tthrow new Error('Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.');\r\n\t}\r\n\r\n\tvar args = (arguments.length > 1) ? Array.prototype.slice.call(arguments, 1) : undefined;\r\n\r\n\treturn this.each(function() {\r\n\t\tvar $this = $(this),\r\n\t\t\t\tdata = $this.data('ripples'),\r\n\t\t\t\toptions = $.extend({}, Ripples.DEFAULTS, $this.data(), typeof option == 'object' && option);\r\n\r\n\t\tif (!data && typeof option == 'string') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!data) {\r\n\t\t\t$this.data('ripples', (data = new Ripples(this, options)));\r\n\t\t}\r\n\t\telse if (typeof option == 'string') {\r\n\t\t\tRipples.prototype[option].apply(data, args);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n$.fn.ripples.Constructor = Ripples;\r\n\r\n\r\n// RIPPLES NO CONFLICT\r\n// ====================\r\n\r\n$.fn.ripples.noConflict = function() {\r\n\t$.fn.ripples = old;\r\n\treturn this;\r\n};\n\n})));\n"]},"metadata":{},"sourceType":"script"}